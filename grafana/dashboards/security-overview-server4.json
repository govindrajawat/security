{
  "id": null,
  "uid": "security-server4-3-28-50-27",
  "title": "security-server4-3.28.50.27",
  "tags": ["security", "monitoring"],
  "style": "dark",
  "timezone": "browser",
  "schemaVersion": 38,
  "version": 1,
  "editable": true,
  "annotations": { "list": [] },
  "templating": {"list": [{"name":"host","type":"query","datasource":{"type":"loki","uid":"loki"},"refresh":1,"query":"label_values({job=~\\\"varlogs|fail2ban|auditd|containers|security\\\"}, host)","includeAll":true,"allValue":".*","multi":false,"label":"Host","current":{"text":"server4","value":"server4","selected":true},"hide":2}]},
  "panels": [
    {"id":1,"title":"System Logs by Host","type":"logs","targets":[{"expr":"{job=\\\"varlogs\\\", host=~\\\"$host\\\"}","refId":"A","datasource":{"type":"loki","uid":"loki"}}],"gridPos":{"h":8,"w":24,"x":0,"y":0}},
    {"id":2,"title":"Container Logs by Host","type":"logs","targets":[{"expr":"{job=\\\"containers\\\", host=~\\\"$host\\\"}","refId":"A","datasource":{"type":"loki","uid":"loki"}}],"gridPos":{"h":8,"w":24,"x":0,"y":8}},
    {"id":3,"title":"Security Events (inotify)","type":"logs","targets":[{"expr":"{job=\\\"security\\\", host=~\\\"$host\\\"}","refId":"A","datasource":{"type":"loki","uid":"loki"}}],"gridPos":{"h":8,"w":24,"x":0,"y":16}},
    {"id":4,"title":"SSH Failed Logins by Host","type":"stat","targets":[{"expr":"sum by (host) (count_over_time({job=\\\"varlogs\\\", host=~\\\"$host\\\", filename=~\\\"/var/log/(auth.log|secure)\\\"} |= \\\"Failed password\\\" [5m]))","refId":"A","datasource":{"type":"loki","uid":"loki"}}],"gridPos":{"h":6,"w":8,"x":0,"y":24}},
    {"id":5,"title":"SSH Successful Logins by Host","type":"stat","targets":[{"expr":"sum by (host) (count_over_time({job=\\\"varlogs\\\", host=~\\\"$host\\\", filename=~\\\"/var/log/(auth.log|secure)\\\"} |= \\\"Accepted password\\\" [5m]))","refId":"A","datasource":{"type":"loki","uid":"loki"}}],"gridPos":{"h":6,"w":8,"x":8,"y":24}},
    {"id":6,"title":"Fail2Ban Bans (last 1h)","type":"stat","targets":[{"expr":"sum by (host) (count_over_time({job=\\\"fail2ban\\\", host=~\\\"$host\\\"} |= \\\"Ban\\\" [1h]))","refId":"A","datasource":{"type":"loki","uid":"loki"}}],"gridPos":{"h":6,"w":8,"x":16,"y":24}},
    {"id":7,"title":"Sudo Usage by Host","type":"stat","targets":[{"expr":"sum by (host) (count_over_time({job=\\\"varlogs\\\", host=~\\\"$host\\\", filename=~\\\"/var/log/(auth.log|secure)\\\"} |= \\\"sudo:\\\" [5m]))","refId":"A","datasource":{"type":"loki","uid":"loki"}}],"gridPos":{"h":6,"w":12,"x":0,"y":30}},
    {"id":8,"title":"Root Shell Sessions","type":"stat","targets":[{"expr":"sum by (host) (count_over_time({job=\\\"varlogs\\\", host=~\\\"$host\\\", filename=~\\\"/var/log/(auth.log|secure)\\\"} |= \\\"session opened for user root\\\" [1h]))","refId":"A","datasource":{"type":"loki","uid":"loki"}}],"gridPos":{"h":6,"w":12,"x":12,"y":30}},
    {"id":9,"title":"Auditd: Command Executions (execve)","type":"logs","targets":[{"expr":"{job=\\\"auditd\\\", host=~\\\"$host\\\"} |~ \\\"type=EXECVE|key=exec_log\\\"","refId":"A","datasource":{"type":"loki","uid":"loki"}}],"gridPos":{"h":8,"w":12,"x":0,"y":36}},
    {"id":10,"title":"Failed Login Attempts (Last 24h)","type":"graph","targets":[{"expr":"sum by (host) (rate({job=\\\"varlogs\\\", host=~\\\"$host\\\"} |= \\\"Failed password\\\" [5m]))","refId":"A","legendFormat":"{{host}}","datasource":{"type":"loki","uid":"loki"}}],"gridPos":{"h":8,"w":12,"x":12,"y":36}},
    {"id":11,"title":"Sudo Commands Executed","type":"logs","targets":[{"expr":"{job=\\\"varlogs\\\", host=~\\\"$host\\\"} |= \\\"sudo:\\\" |~ \\\"COMMAND=.*\\\"","refId":"A","datasource":{"type":"loki","uid":"loki"}}],"gridPos":{"h":8,"w":24,"x":0,"y":44}},
    {"id":12,"title":"Root Access Events","type":"logs","targets":[{"expr":"{job=\\\"varlogs\\\", host=~\\\"$host\\\"} |~ \\\"session opened for user root|Accepted (publickey|password) for root\\\"","refId":"A","datasource":{"type":"loki","uid":"loki"}}],"gridPos":{"h":8,"w":24,"x":0,"y":52}},
    {"id":13,"title":"Security Events Timeline","type":"graph","targets":[{"expr":"sum by (host) (rate({job=\\\"varlogs\\\", host=~\\\"$host\\\"} |= \\\"Failed password\\\" [1m]))","refId":"A","legendFormat":"Failed Logins - {{host}}"},{"expr":"sum by (host) (rate({job=\\\"fail2ban\\\", host=~\\\"$host\\\"} |= \\\"Ban\\\" [1m]))","refId":"B","legendFormat":"Fail2Ban Bans - {{host}}"},{"expr":"sum by (host) (rate({job=\\\"auditd\\\", host=~\\\"$host\\\"} |~ \\\"type=EXECVE|key=exec_log\\\" [1m]))","refId":"C","legendFormat":"Command Executions - {{host}}"}],"gridPos":{"h":8,"w":24,"x":0,"y":60}}
  ],
  "time": {"from":"now-1h","to":"now"},
  "refresh": "30s"
}


